# BulletMovement 组件使用手册

## 版本：1.0

### 1. 组件概述

`BulletMovementComponent` 是一个轻量级、无物理模拟、完全参数驱动的子弹移动组件，专为弹幕游戏和射击游戏设计。该组件通过参数化的配置实现高性能的子弹行为，支持加速、减速、反弹、追踪、回归等常见功能。

---

## 2. 组件功能

### **基础功能**
- **速度控制**：支持设置初始速度、最大速度和停止速度。
- **时间/距离控制**：支持设置最大存在时间和最大移动距离。
- **加速与减速**：支持常规加速与减速、加速度曲线和命中后减速效果。

### **特殊轨迹**
- **反弹与定向反射**：支持标准反弹、定向反射和自动反射。
- **追踪与回归**：支持目标追踪、回归目标等特殊弹道行为。

---

## 3. 组件参数

### **基本设置**
- **`Bullet (AActor*)`**  
  当前子弹的 `Actor` 实例。  
  **访问性**: 蓝图参数  
  **描述**: 存储子弹的 `Actor`，用于执行子弹的移动和碰撞检查。

- **`BulletOwner (AActor*)`**  
  当前子弹的所有者 `Actor` 实例。  
  **访问性**: 蓝图参数  
  **描述**: 存储子弹所属的 `Actor`。

- **`IgnoreActors (TArray<AActor*>)`**  
  子弹忽略的其他 `Actor` 列表。  
  **访问性**: 蓝图参数  
  **描述**: 子弹在进行碰撞检测时，会忽略列表中的 `Actor`，包括子弹本身。

### **运动参数**
- **`InitialSpeed (float)`**  
  子弹的初始速度。  
  **访问性**: 组件参数  
  **描述**: 设置子弹的启动速度。

- **`MaxSpeed (float)`**  
  子弹的最大速度。  
  **访问性**: 组件参数  
  **描述**: 设置子弹能够达到的最大速度。如果为 `0`，则不限制速度。

- **`MinSpeed (float)`**  
  子弹的最小速度，当速度低于此值时，子弹会停止。  
  **访问性**: 组件参数  
  **描述**: 设置子弹的最小速度，低于此速度时会触发停止事件。

- **`MaxMoveDistance (float)`**  
  子弹的最大移动距离。  
  **访问性**: 组件参数  
  **描述**: 设置子弹的最大移动距离，超过此距离后子弹会停止。

### **加速与减速**
- **`AcceleInfo (TArray<BulletAcceleInfo>)`**  
  子弹的加速度信息，允许为子弹设置加速度和加速度曲线。  
  **访问性**: 组件参数  
  **描述**: 包含加速度数据，可以使用加速度曲线来控制加速度的变化。

- **`HitDeceleration (TArray<BulletDeceleInfo>)`**  
  子弹的减速信息，当子弹碰撞时会触发减速效果。  
  **访问性**: 组件参数  
  **描述**: 定义子弹碰撞后的减速效果，可以设置多个减速阶段。

- **`GravityScale (float)`**  
  子弹的重力影响比例。  
  **访问性**: 组件参数  
  **描述**: 设置子弹受重力影响的程度。如果为 `0`，则子弹不受重力影响。

### **反弹与反射**
- **`RefractType (E_BulletRefractType)`**  
  子弹的反弹类型。  
  **访问性**: 组件参数  
  **描述**: 定义子弹碰撞后的反弹行为，支持标准反弹和定向反射。

- **`RefractTime (int32)`**  
  子弹的最大反弹次数。  
  **访问性**: 组件参数  
  **描述**: 设置子弹的最大反弹次数，超过次数后子弹停止。

### **追踪与回归**
- **`bUseHoming (bool)`**  
  是否启用追踪功能。  
  **访问性**: 组件参数  
  **描述**: 如果启用，子弹会追踪指定的目标。

- **`HomingTarget (USceneComponent*)`**  
  追踪目标。  
  **访问性**: 组件参数  
  **描述**: 子弹会追踪此目标，如果没有指定目标，则追踪失效。

- **`ReturnRange (float)`**  
  子弹回归时的距离阈值。  
  **访问性**: 组件参数  
  **描述**: 设置子弹开始回归的距离范围。

---

## 4. 蓝图函数

### **ActiveBulletMovement**
**描述**  
激活或停用子弹的移动。  
**参数**:
- `ActiveBullet (AActor*)`: 需要控制的子弹 `Actor`。
- `Active (bool)`: `true` 启用子弹移动，`false` 停用子弹。

**说明**  
此函数用于启动或停止子弹的移动，若启用，子弹会按照当前设置的参数进行运动，若停用，子弹会停止。

---

### **SetupHoming**
**描述**  
设置子弹的追踪目标。  
**参数**:
- `Target (USceneComponent*)`: 追踪的目标。

**说明**  
启用追踪功能后，子弹会自动朝 `Target` 方向移动。若未启用追踪，子弹会按照当前方向移动。

---

### **UpdateInitialSpeed**
**描述**  
更新子弹的初始速度。  
**参数**:
- `Speed (float)`: 新的初始速度值。

**说明**  
此函数用于动态调整子弹的初始速度。调用此函数后，子弹的速度将根据新的初始速度重新计算。

---

### **AddAcceleration**
**描述**  
为子弹添加加速度信息。  
**参数**:
- `Info (BulletAcceleInfo)`: 加速度信息，包括默认加速度值和加速度曲线。

**说明**  
此函数用于为子弹添加新的加速度配置，支持使用曲线来动态调整加速度。

---

### **AddDeceleration**
**描述**  
为子弹添加减速阶段。  
**参数**:
- `Info (TArray<BulletDeceleInfo>)`: 减速信息，包括每个阶段的最大次数和减速幅度。

**说明**  
此函数用于为子弹添加多个减速阶段配置，当子弹碰撞后会按照这些配置进行减速。

---

### **AddForce**
**描述**  
添加外部力到子弹。  
**参数**:
- `Code (FName)`: 外部力的唯一标识符。
- `Force (Vector)`: 外部力的大小和方向。

**说明**  
此函数可以添加外部力到子弹，外部力可以是瞬时的或持久的。

---

## 5. 事件回调

### **OnBulletStop**
**描述**  
当子弹停止时触发，通知停止的原因。  
**参数**:
- `Reason (E_BulletStopReason)`: 停止原因，可能的值包括：时间到、距离到、速度过低等。

---

### **OnBulletRefracted**
**描述**  
当子弹反弹时触发，通知反弹的命中信息和反弹后的速度。  
**参数**:
- `Hit (HitResult)`: 反弹命中的碰撞结果。
- `Velocity (Vector)`: 反弹后的速度。

---

### **OnBulletHomingLost**
**描述**  
当子弹丢失追踪目标时触发。

---
