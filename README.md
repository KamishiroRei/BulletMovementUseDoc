# BulletMovement 组件使用手册

## 版本：1.0

### 1. 组件概述

`BulletMovement` 是一个轻量级的子弹移动组件，旨在为射击游戏、弹幕游戏等非物理驱动的子弹场景提供简单、灵活的移动控制。通过参数化配置，玩家可以快速实现多种弹道效果，支持从基本的子弹移动到复杂的反射、追踪、回归等效果。

#### 功能支持：
1. **基础弹道控制**：
   - 支持加速/减速，包括固定值和动态曲线方式。
   - 支持阶段式命中速度变化（基于命中次数和阶段控制）。
   - 支持子弹的最大射程控制。
   - 支持阶段化时间控制，每个阶段可以触发特定效果。

2. **特殊轨迹效果**：
   - 支持持续或单次偏转子弹轨迹的效果。
   - 提供高性能数值化反弹效果，支持标准反弹和定向反弹。
   - 支持手动或自动反射的方向性反弹效果。

3. **追踪与导弹尾迹**：
   - 支持基于百分比的诱导追踪效果。
   - 通过曲线动态控制追踪性能的变化。
   - 集成导弹尾迹特效，不会随着子弹消失而立刻消失。
   - 支持回归效果，子弹可以指定回归对象并返回。

### 2. 使用方式

1. **在 Actor 内添加 BulletMovement 组件**
   将 `BulletMovement` 组件添加到角色或物体的 Actor 中。

2. **调整组件参数**：
   - **初始速度**：设置子弹启动时的原始速度。
   - **最大速度**：设置子弹能够达到的最大速度。如果为 0 则不限制子弹的最大速度。
   - **停止速度**：当子弹的速度减至此值以下时，触发停止事件，原因是速度过低。
   - **最大移动距离**：设置子弹的最大移动距离，超过此距离触发停止事件。
   - **最大存在时间/阶段**：设置子弹的生存时间，每个阶段的时间限制，超过时间触发停止事件。
   - **初始速度指向瞄准位置**：启用后，子弹将在激活时指向目标位置。
   - **瞄准方向**：设置子弹的目标方向（世界位置）。

3. **物理与加速度设置**：
   - **加速度信息**：设置子弹的加速度，可以使用动态曲线调整加速度变化。
   - **命中后减速/阶段**：设置子弹命中后的减速效果，可以分阶段设置减速的强度。
   - **重力尺度**：设置子弹受重力影响的程度，与场景的默认重力相乘来影响子弹轨迹。
   
4. **特效设置**：
   - **拖尾特效**：为子弹设置拖尾特效，并控制特效的大小和消失时机。
   - **反射类型**：设置子弹命中后的反射类型，支持标准反弹和定向反射。 
   - **追踪效率**：控制子弹的追踪效率，支持通过曲线调整动态追踪表现。
   - **回归效果**：设置子弹在命中目标后是否回归，并指定回归目标和插槽。

---

### 组件详细功能介绍：
- **反弹效果**：
  - 标准反弹：沿命中法线进行镜像反弹。
  - 定向反弹：根据指定的反射目标进行反弹，支持自动检测反射目标。
  - 自动反射：检测指定距离内的目标并进行反射。

- **追踪与回归**：
  - 追踪效果：控制子弹自动追踪目标，可以手动启用追踪并通过曲线动态调整追踪强度。
  - 回归效果：当子弹停止时，可以根据回归目标进行回归，适用于回旋镖、火箭等类型。
 
  # BulletMovementComponent 用户手册

基于UE5.5开发的子弹运动组件，支持弹道跟踪、重力模拟、折射反射、归位系统、加速/减速曲线等特性，适用于弹幕射击类游戏开发。

---

## 组件参数 (Editable in Editor)
| **参数分类** | **显示名称** | **C++类型** | **默认值** | **说明** |
|--------------|--------------|-------------|------------|----------|
| **Bullet Performance** |  |  |  |  |
|  | `Initial Speed` | `float` | 0 | 子弹初始速度（单位/秒） |
|  | `Max Speed` | `float` | 0 | 最大速度限制（0=无限制） |
|  | `Min Speed` | `float` | 0 | 触发停止的最小速度阈值 |
|  | `Max Move Distance` | `float` | 0 | 最大移动距离限制（0=无限制） |
|  | `Gravity Scale` | `float` | 0 | 重力缩放系数（0=禁用重力） |
|  | `Initial Follow AimPoint` | `uint8` | false | 初始速度是否朝向瞄准点（AimPoint） |
|  | `Aiming Point` | `FVector` | (0,0,0) | 初始瞄准点坐标（仅在`bFollowAim`启用时生效） |
| **Bullet Trail Effect** |  |  |  |  |
|  | `Trail Effect` | `UNiagaraSystem*` | nullptr | 拖尾粒子特效资产 |
|  | `Effect Scale` | `float` | 1 | 拖尾特效缩放系数 |
| **Bullet Refract** |  |  |  |  |
|  | `Refract Type` | `E_BulletRefractType` | None | 子弹折射类型：<br>- **No Refract**：碰撞后停止<br>- **Standard**：镜面反射<br>- **Targeted**：导向目标折射 |
|  | `Refract Count` | `int32` | 0 | 最大折射次数（-1=无限） |
|  | `Max Detection Range for Directional Refract` | `float` | 0 | 自动折射目标检测范围半径 |
|  | `Max Angle for Auto Refract` | `float` | 0 | 自动折射目标检测最大角度（单位：度） |
| **Bullet Homing** |  |  |  |  |
|  | `Homing Efficiency` | `float` | 0 | 自动跟踪效率（0-100） |
|  | `Homing Curve` | `UCurveFloat*` | nullptr | 跟踪效率随时间变化的曲线 |
|  | `Return Completion Distance` | `float` | 100 | 归位完成判定距离（平方值） |

---

## 蓝图参数 (Runtime Only)
| **分类** | **变量名** | **C++类型** | **说明** |
|----------|------------|-------------|----------|
| **Bullet Basic Info** |  |  |  |
|  | `Bullet` | `AActor*` | 当前控制的子弹Actor |
|  | `BulletOwner` | `AActor*` | 子弹所有者Actor |
|  | `IgnoreActors` | `TArray<AActor*>` | 忽略碰撞的Actor列表（含自身） |
| **Bullet Performance** |  |  |  |
|  | `CurrentSpeed` | `float` | 当前实时速度 |
|  | `MovedDistance` | `float` | 已移动距离（平方值） |
|  | `BulletStep` | `int32` | 当前时间阶段索引 |
| **Bullet Trail Effect** |  |  |  |
|  | `TrailComp` | `UNiagaraComponent*` | 拖尾特效组件实例 |

---

## 事件系统
| **事件名称** | **触发条件** | **参数** | **说明** |
|--------------|--------------|----------|----------|
| `On Bullet Lost Homing Target` | 跟踪目标丢失时触发 | 无 |  |
| `On Bullet Triggered Refract` | 子弹发生折射时触发 | - **Hit**：碰撞数据<br>- **Velocity**：折射前速度向量 |  |
| `On Bullet Time Step Up` | 进入新时间阶段时触发 | **Step**：新阶段索引 |  |
| `On Bullet Triggered Deceleration` | 触发减速阶段时触发 | - **CurrentSpeed**：当前速度<br>- **DeceleStep**：减速阶段索引 |  |
| `On Bullet Starts Returning` | 开始归位时触发 | - **ReturnMesh**：目标网格体<br>- **ReturnSocket**：目标插槽 |  |
| `On Bullet Movement Stopped` | 子弹停止时触发 | **Reason**：停止原因枚举 |  |

---
